<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Debugger-based On-Target Testing: Reference Platform</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxyStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ams_dott_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Debugger-based On-Target Testing
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Reference Platform </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Overview">Overview</a><ul><li class="level2"><a href="#ReferenceBoard">Reference Board</a></li>
<li class="level2"><a href="#STLinkConversion">Converting the ST-Link Debugger to J-Link</a></li>
<li class="level2"><a href="#GdbServer">Launching GSB Server and verifying Target Connection</a></li>
<li class="level2"><a href="#ExistingJLink">Using an existing J-Link Debugger</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>To make the initial effort for new users as low as possible when evaluating DOTT, a cheap off the shelf reference platform was selected. All examples which are provided with the DOTT framework are pre-configured for this reference board. The reference board comes with and on-board debugger such that no additional hardware is required for the evaluation of DOTT.</p>
<h2><a class="anchor" id="ReferenceBoard"></a>
Reference Board</h2>
<p>The reference platform is <b>STM32F072 Nucleo-64</b> board equipped with a Cortex M0 clocked at up to 48Mhz, 128KB on-chip flash and 16KB of on-chip SRAM. For evaluating DOTT, the board can be purchased for about 10 Euros at Farnell or other distributors (ST order code: NUCLEO-F072RB). Note that most of the example code is generic such that it can be built for and executed also on other Coretx-M0 devices. Only some parts of the examples make use of peripherals specific to the STM32F072 and hence would need to be ported. A picture of the board is shown below.</p>
<p>The reference board is divided into two halves, a bigger section carrying the STM32F072 MCU together with two buttons and I/O pins and a smaller section (with USB connector) implementing an ST-Link debugger. Via a firmware update the ST-Link debugger can be transformed into a J-Link debug probe.</p>
<div class="image">
<img src="stm32f072_annotated.png" alt="stm32f072_annotated.png"/>
<div class="caption">
The STM32F072 evaluation board serving as reference board for DOTT. The upper part of the board with the USB connector is the debug probe, the lower part carries the MCU and I/O ports.</div></div>
 <h2><a class="anchor" id="STLinkConversion"></a>
Converting the ST-Link Debugger to J-Link</h2>
<blockquote class="doxtable">
<p><b>Note:</b> If you already have a Segger J-Link debug probe available you can skip this section and follow the steps outlined in the next section below. </p>
</blockquote>
<p>For use with DOTT, the ST-Link debugger is now converted into a Segger J-Link debug probe. The conversion process is summarized below. Additional background on this topic and an extended description is provided on the <a href="https://www.segger.com/products/debug-probes/j-link/models/other-j-links/st-link-on-board">Segger website</a>.</p>
<blockquote class="doxtable">
<p><b>ST-Link to J-Link conversion summary:</b></p><ol type="1">
<li>Install the ST-Link USB drivers which can be downloaded from the [ST website][<a href="https://www.st.com/en/development-tools/stsw-link009.html">https://www.st.com/en/development-tools/stsw-link009.html</a>]. Execute <code>dpinst_amd64.exe</code> to install the driver.</li>
<li>Connect the STM32F072 board to your PC via USB and execute the ST-Link reflash utility <code>STLinkReflash.exe</code> available for download at the [Segger website][<a href="https://www.segger.com/downloads/jlink#STLink_Reflash">https://www.segger.com/downloads/jlink#STLink_Reflash</a>]. Follow the steps to upgrade your device to J-Link.</li>
<li>It is assumed that you already have the J-Link software package installed as described in the <a class="el" href="SetupAndTarget.html">setup guide</a>. </li>
</ol>
</blockquote>
<p>Once you have completed these steps, you can now verify that the J-Link probe works as expected. This is described in the following section.</p>
<p>If you want to convert the J-Link debugger back to the original ST-Link debugger this can also be done with the <code>STLinkReflash.exe</code> utility.</p>
<h2><a class="anchor" id="GdbServer"></a>
Launching GSB Server and verifying Target Connection</h2>
<p>To do so start the <code>J-Link GDB Server</code> from the Segger folder in the start menu. In apply the settings as show in the screenshot below (USB, SWD, device type).</p>
<div class="image">
<img src="gdb_server_settings.png" alt="gdb_server_settings.png"/>
<div class="caption">
GDB server settings for the reference platform connected to the host via USB.</div></div>
<p> Click <code>OK</code> and accept Segger's terms of use. If you have multiple J-Links connected to your system the tool will next ask you which one to use. Please ensure to select the correct one. If the conversion from ST-Link to J-Link was successful you should next see a window as shown below. The 'LEDs' in the <code>J-Link</code> and <code>Device</code> should be green. You can now close the GDB server window.</p>
<div class="image">
<img src="gdb_server_status.png" alt="gdb_server_status.png"/>
<div class="caption">
GDB server window if conversion to J-Link was successful. LEDs for J-Link and Device are green.</div></div>
 <blockquote class="doxtable">
<p><b>Note on terms of use:</b> Please note that <em>Segger's terms of use</em> limit the application of this converted ST-Link/J-Link debug probe to ST target devices on evaluation boards. Using it with custom hardware of beyond evaluation purposes is not allowed. Please keep that in mind if your evaluation of DOTT was successful and you would like to apply it in your project. </p>
</blockquote>
<h2><a class="anchor" id="ExistingJLink"></a>
Using an existing J-Link Debugger</h2>
<p>If you already have a J-Link debug probe and want to use this instead of converting the on-board ST-Link to J-Link this is also possible. For this you have to perform the following steps.</p>
<blockquote class="doxtable">
<p><b>Connect existing J-Link to target:</b></p><ol type="1">
<li>Disconnect the USB cable form the STM32F072 board (the target will be powered via the J-Link)</li>
<li>Remove the two jumpers on the CN2 header.</li>
<li>Set the C20 jumper to E5V (external 5 volt supply instead of the default setting U5V)</li>
<li>Connect the SWD data and clock lines as well as nReset, GND, 5V and VTRef as shown in the figure below. </li>
</ol>
</blockquote>
<div class="image">
<img src="stm32f072_annotated_jlink.png" alt="stm32f072_annotated_jlink.png"/>
<div class="caption">
Interconnect between STM32F072 and external J-Link debug probe.</div></div>
<p> Assuming that you have the J-Link tools already installed, you can now check the connection to the target device as described in a previous section. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
